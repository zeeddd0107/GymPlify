<!DOCTYPE html>
<html>
<head>
  <title>Check Subscription Debug</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Your Firebase config (copy from web/src/config/firebase.js)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      // ... rest of config
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function checkSubscription() {
      const userEmail = prompt("Enter user email:");
      if (!userEmail) return;

      console.log("Searching for user:", userEmail);

      // Find user by email
      const usersRef = collection(db, "users");
      const userQuery = query(usersRef, where("email", "==", userEmail));
      const userSnapshot = await getDocs(userQuery);

      if (userSnapshot.empty) {
        console.log("User not found!");
        return;
      }

      const userId = userSnapshot.docs[0].id;
      const userData = userSnapshot.docs[0].data();
      console.log("User found:", userId);
      console.log("Active subscription ID:", userData.activeSubscriptionId);

      if (!userData.activeSubscriptionId) {
        console.log("No active subscription!");
        return;
      }

      // Get subscription
      const subsRef = collection(db, "subscriptions");
      const subsQuery = query(subsRef, where("__name__", "==", userData.activeSubscriptionId));
      const subsSnapshot = await getDocs(subsQuery);

      if (subsSnapshot.empty) {
        console.log("Subscription not found!");
        return;
      }

      const subData = subsSnapshot.docs[0].data();
      console.log("=== SUBSCRIPTION DATA ===");
      console.log("Plan:", subData.planName);
      console.log("Start Date:", subData.startDate?.toDate?.() || subData.startDate);
      console.log("End Date:", subData.endDate?.toDate?.() || subData.endDate);
      console.log("Days Remaining (stored):", subData.daysRemaining);
      
      // Calculate actual days remaining
      const endDate = subData.endDate?.toDate?.() || new Date(subData.endDate);
      const now = new Date();
      const diffDays = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
      console.log("Days Remaining (calculated):", diffDays);
      
      console.log("\n=== EXTENSION INFO ===");
      console.log("Extension Type:", subData.extensionType);
      console.log("Current Remaining Days:", subData.currentRemainingDays);
      console.log("New Monthly Days:", subData.newMonthlyDays);
      console.log("Total Extension Days:", subData.totalExtensionDays);
      
      console.log("\n=== RAW DATA ===");
      console.log(subData);

      // Display in page
      document.body.innerHTML = `
        <h1>Subscription Debug Info</h1>
        <pre>${JSON.stringify({
          userId,
          planName: subData.planName,
          startDate: subData.startDate?.toDate?.() || subData.startDate,
          endDate: subData.endDate?.toDate?.() || subData.endDate,
          daysRemainingStored: subData.daysRemaining,
          daysRemainingCalculated: diffDays,
          extensionType: subData.extensionType,
          currentRemainingDays: subData.currentRemainingDays,
          newMonthlyDays: subData.newMonthlyDays,
          totalExtensionDays: subData.totalExtensionDays,
        }, null, 2)}</pre>
      `;
    }

    window.checkSubscription = checkSubscription;
    
    // Auto-run on load
    setTimeout(checkSubscription, 1000);
  </script>
</head>
<body>
  <h1>Loading...</h1>
  <p>Check the console for debug info</p>
  <button onclick="checkSubscription()">Check Again</button>
</body>
</html>

